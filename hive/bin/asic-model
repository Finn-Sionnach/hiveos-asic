#!/hive/sbin/bash

[ -e "/usr/bin/compile_time" ] && ASIC_MODEL=`sed -n 2p /usr/bin/compile_time`
[ -e "/opt/system/bank.conf" ] && ASIC_MODEL="ebit"
[ -e "/etc/hwrevision" ] && ASIC_MODEL=`cut -d\  -f 2 /etc/hwrevision`

if [[ $ASIC_MODEL == "Antminer S9" || $ASIC_MODEL == "Antminer S9i" || $ASIC_MODEL == "Antminer S9 Hydro" || $ASIC_MODEL == "Antminer S9j" || $ASIC_MODEL =~ "Antminer S9 (vnish" ]]; then
	MOUNT=""
	ASIC_ALGO="sha256"
	THIS_MINER_NAME="bmminer"
	LOG_PATH="/var/volatile/tmp/temp"
	CONFIG_PATH="/config/bmminer.conf"
	HASH="ghs"
	MAX_FAN_RPM="6000"
	GPIO_LED_RED="70"
#	GPIO_LED_RED="23"
	GPIO_PATH="direction"
elif [[ $ASIC_MODEL == "Antminer S7" ]]; then
	MOUNT=""
	ASIC_ALGO="sha256"
	THIS_MINER_NAME="cgminer"
	LOG_PATH="/var/volatile/log/messages"
	CONFIG_PATH="/config/cgminer.conf"
	HASH="ghs"
	MAX_FAN_RPM="6000"
	GPIO_LED_RED="70"
#	GPIO_LED_RED="23"
	GPIO_PATH="direction"
elif [[ $ASIC_MODEL == "Antminer A3" ]]; then
	MOUNT="config"
	ASIC_ALGO="Blake(2b)"
	THIS_MINER_NAME="cgminer"
	LOG_PATH="/var/volatile/log/messages"
	CONFIG_PATH="/config/cgminer.conf"
	HASH="ghs"
	MAX_FAN_RPM="6000"
	GPIO_LED_RED="45"
	GPIO_PATH="value"
elif [[ $ASIC_MODEL == "Antminer Z9" || $ASIC_MODEL == "Antminer Z9-Mini" ]]; then
	MOUNT="config"
	ASIC_ALGO="Equihash"
	THIS_MINER_NAME="cgminer"
	LOG_PATH="/var/volatile/log/messages"
	CONFIG_PATH="/config/cgminer.conf"
	HASH="khs"
	MAX_FAN_RPM="8000"
	GPIO_LED_RED="941"
	GPIO_PATH="value"
elif [[ $ASIC_MODEL == "Antminer X3" ]]; then
	MOUNT="config"
	ASIC_ALGO="CryptoNight"
	THIS_MINER_NAME="cgminer"
	LOG_PATH="/var/volatile/log/messages"
	CONFIG_PATH="/config/cgminer.conf"
	HASH="khs"
	MAX_FAN_RPM="6000"
	GPIO_LED_RED="45"
	GPIO_PATH="value"
elif [[ $ASIC_MODEL == "Antminer D3" || $ASIC_MODEL =~ "Antminer D3 Blissz" ]]; then
	MOUNT="config"
	ASIC_ALGO="X11"
	THIS_MINER_NAME="cgminer"
	LOG_PATH="/var/volatile/log/messages"
	CONFIG_PATH="/config/cgminer.conf"
	HASH="mhs"
	MAX_FAN_RPM="6000"
	GPIO_LED_RED="45"
	GPIO_PATH="value"
elif [[ $ASIC_MODEL == "Antminer L3+" || $ASIC_MODEL == "Antminer L3++" ]]; then
	MOUNT="config"
	ASIC_ALGO="Scrypt"
	THIS_MINER_NAME="cgminer"
	LOG_PATH="/var/volatile/log/messages"
	CONFIG_PATH="/config/cgminer.conf"
	HASH="mhs"
	MAX_FAN_RPM="6000"
	GPIO_LED_RED="45"
	GPIO_PATH="value"
elif [[ $ASIC_MODEL == "Antminer L3 Blissz" ]]; then
	MOUNT="config"
	ASIC_ALGO="Scrypt"
	THIS_MINER_NAME="cgminer"
	LOG_PATH="/var/volatile/log/messages"
	CONFIG_PATH="/config/cgminer.conf"
	HASH="mhs"
	MAX_FAN_RPM="6000"
	GPIO_LED_RED="45"
	GPIO_PATH="value"
elif [[ $ASIC_MODEL == "Antminer T9+" || $ASIC_MODEL == "Antminer T9"  ]]; then
	MOUNT=""
	ASIC_ALGO="sha256"
	THIS_MINER_NAME="bmminer"
	LOG_PATH="/var/volatile/tmp/temp"
	CONFIG_PATH="/config/bmminer.conf"
	HASH="ghs"
	MAX_FAN_RPM="6000"
	GPIO_LED_RED="70"
	GPIO_PATH="direction"
elif [[ $ASIC_MODEL == "Antminer E3" ]]; then
	MOUNT=""
	ASIC_ALGO="Ethash"
	THIS_MINER_NAME="bmminer"
	LOG_PATH="/mnt/tmp/bmminer.log"
	CONFIG_PATH="/config/bmminer.conf"
	HASH="mhs"
	MAX_FAN_RPM="6000"
elif [[ $ASIC_MODEL == "Antminer " ]]; then
	MOUNT=""
	ASIC_ALGO="Tensority"
	THIS_MINER_NAME="bmminer"
	LOG_PATH="/var/volatile/tmp/temp"
	CONFIG_PATH="/config/bmminer.conf"
	HASH="hs"
	MAX_FAN_RPM="6000"
elif [[ $ASIC_MODEL == "ebit" ]]; then
	MOUNT=""
	ASIC_ALGO="sha256"
	THIS_MINER_NAME="dwang_btc_miner"
	LOG_PATH=""
	CONFIG_PATH=""
	HASH="ghs"
	LOCALIP=`ifconfig eth0 | grep 'inet addr:' | cut -d: -f2 | awk '{ print $1}'`
	MAX_FAN_RPM="6000"
elif [[ $ASIC_MODEL == "b29+.g19" ]]; then
	MOUNT=""
	ASIC_ALGO="Equihash"
	THIS_MINER_NAME="cgminer"
	LOG_PATH=""
	CONFIG_PATH="/config/cgminer.conf"
	HASH="hs"
	MAX_FAN_RPM="6000"
elif [[ $ASIC_MODEL == "d9.g19" ]]; then
	MOUNT=""
	ASIC_ALGO="Blake256R14"
	THIS_MINER_NAME="cgminer"
	LOG_PATH=""
	CONFIG_PATH="/config/cgminer.conf"
	HASH="mhs"
	MAX_FAN_RPM="6000"
elif [[ $ASIC_MODEL == "s11.g19" ]]; then
	MOUNT=""
	ASIC_ALGO="Blake2B"
	THIS_MINER_NAME="cgminer"
	LOG_PATH=""
	CONFIG_PATH="/config/cgminer.conf"
	HASH="mhs"
	MAX_FAN_RPM="6000"
else
	MOUNT=""
	ASIC_ALGO="unknown"
	THIS_MINER_NAME="na"
	LOG_PATH=""
	CONFIG_PATH=""
	HASH=""
	MAX_FAN_RPM="6000"
	GPIO_LED_RED=""
fi
